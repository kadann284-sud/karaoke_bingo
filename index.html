<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚«ãƒ©ã‚ªã‚±ãƒ“ãƒ³ã‚´</title>

  <style>
    body {
      font-family: "Segoe UI", system-ui, sans-serif;
      background: linear-gradient(135deg, #1e1e2f, #2b2b45);
      color: #fff;
      margin: 0;
      padding: 16px;
    }

    h1 {
      text-align: center;
      margin-bottom: 8px;
    }

    .container {
      max-width: 900px;
      margin: auto;
    }

    .controls,
    .description,
    .conditions-box,
    .range-controls {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .controls input,
    .range-controls input {
      width: 100%;
      padding: 8px;
      margin-bottom: 8px;
      border-radius: 8px;
      border: none;
    }

    button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      background: linear-gradient(135deg, #ff7a18, #ffb347);
      color: #000;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 12px;
    }

    td {
      height: 150px;
      border-radius: 18px;
      text-align: center;
      font-weight: bold;
      font-size: 26px;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
      position: relative;
    }

    td.marked {
      background: #00e676 !important;
      color: #000;
    }

    .range {
      display: block;
      font-size: 12px;
      font-weight: normal;
      margin-top: 4px;
      opacity: 0.95;
    }

    /* å…¥åŠ›ã—ãŸç‚¹æ•°ãŒã“ã®ãƒã‚¹ã®ç¯„å›²ã«å…¥ã£ãŸã‚‰å¼·èª¿ */
    td.in-range {
      outline: 5px solid #fff;
      transform: translateY(-2px);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.55);
    }

    td.in-range::after {
      content: "â¬… ã“ã‚Œï¼";
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.85);
      color: #000;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 700;
    }

    /* ã‚«ãƒ†ã‚´ãƒªè‰² */
    .cat-release {
      background: #ff8a80;
    }

    .cat-title {
      background: #82b1ff;
    }

    .cat-lang {
      background: #b9f6ca;
    }

    .cat-artist {
      background: #ffd180;
    }

    .cat-other {
      background: #e1bee7;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: #fff;
      color: #000;
      padding: 24px 32px;
      border-radius: 16px;
      font-size: 32px;
      font-weight: bold;
    }

    /* æ¡ä»¶ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ç”¨ */
    .conditions-box ul {
      margin: 8px 0 0;
      padding-left: 18px;
    }

    .conditions-box li {
      margin: 6px 0;
      list-style: none;
    }

    .cond-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .cond-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #ffb347;
      cursor: pointer;
    }

    .cond-note {
      opacity: 0.85;
      font-size: 12px;
      margin-top: 8px;
    }

    /* è¿½åŠ ï¼šç‚¹æ•°å…¥åŠ›ã®è¦‹ãŸç›® */
    .range-controls .row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.12);
      font-size: 12px;
      margin-top: 4px;
    }

    .hint {
      opacity: 0.85;
      font-size: 12px;
      margin-top: 4px;
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <h1>ğŸ¤ ã‚«ãƒ©ã‚ªã‚±ãƒ“ãƒ³ã‚´</h1>

  <div class="description">
    <p>
      é–‹å§‹ç‚¹æ•°ã¨ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã€äººæ•°ã‚’å…¥åŠ›ã—ã¦ãƒ“ãƒ³ã‚´ç”Ÿæˆã€‚<br>
      æ¡ä»¶ã¨ç‚¹æ•°ãŒä¸€è‡´ã—ãŸã‚‰ãƒã‚¹ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚
    </p>

    <br>

    <p style="font-size: 20px; font-weight: bold;">
      ã‚«ãƒ©ã‚ªã‚±ãƒ“ãƒ³ã‚´ã®ãƒ«ãƒ¼ãƒ«
    </p>

    <p>
      1. ä»»æ„ã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚’3ã¤ã¨é–‹å§‹ç‚¹æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
      2. ã€Œãƒ“ãƒ³ã‚´ã‚’ç”Ÿæˆã€ã‚’æŠ¼ã™ã¨ã€é–‹å§‹ç‚¹æ•°ã‹ã‚‰+10ç‚¹ã¾ã§ã®ç¯„å›²ã§ãƒã‚¹ãŒãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚Œã¾ã™ã€‚<br>
      3. è‡ªåˆ†ãŒæ­Œã£ãŸæ›²ã‚„ä»–ã®äººãŒæ­Œã£ãŸæ›²ã§ã€ãƒã‚¹ã®æ¡ä»¶ã«å½“ã¦ã¯ã¾ã£ãŸå ´åˆã¯ã€è©²å½“ãƒã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒãƒ¼ã‚¯ã—ã¦ãã ã•ã„ã€‚<br>
      4. ä»–ã®äººãŒã™ã§ã«æ­Œã£ãŸæ›²ã¯ã€åŒã˜æ›²ã‚’ã‚‚ã†ä¸€åº¦æ­Œã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚<br>
      5. æ¡ä»¶ãƒªã‚¹ãƒˆã¯å³å´ã§ãƒ“ãƒ³ã‚´ç”Ÿæˆå‰ã«ç¢ºèªã§ãã¾ã™ã€‚
    </p>
  </div>


  <div class="container">
    <div class="controls">
      <input id="artist1" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ1">
      <input id="artist2" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ2">
      <input id="artist3" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ3">

      <label>é–‹å§‹ç‚¹æ•°ï¼ˆç‚¹ï¼‰</label>
      <input id="startScore" type="number" value="80">

      <label>éŠã¶äººæ•°ï¼ˆäººï¼‰</label>
      <input id="playerCount" type="number" min="1" value="2">

      <button onclick="generateBingo()">ãƒ“ãƒ³ã‚´ç”Ÿæˆ</button>
    </div>

    <!-- â˜…è¿½åŠ ï¼šç‚¹æ•°ç¯„å›²ã‚’å¤‰ãˆã‚‰ã‚Œã‚‹ï¼†å…¥åŠ›ç‚¹æ•°ã§è©²å½“ãƒã‚¹ã‚’å¼·èª¿ -->
    <div class="range-controls">
      <strong>ç‚¹æ•°ç¯„å›²ãƒ»å…¥åŠ›ç‚¹æ•°</strong>
      <div class="row" style="margin-top:8px;">
        <div>
          <label>ç‚¹æ•°ç¯„å›²ï¼ˆä¸‹ã«ä½•ç‚¹ã€œä¸Šã«ä½•ç‚¹è¡¨ç¤ºã™ã‚‹ã‹ï¼‰</label>
          <input id="rangeDown" type="number" step="0.01" value="1.00" min="0">
          <input id="rangeUp" type="number" step="0.01" value="0.99" min="0">
          <div class="hint">
            ä¾‹ï¼š<span class="badge">ä¸‹ 1.00 / ä¸Š 0.99</span> â†’ ã€Œ85ç‚¹ã€ã®ä¸‹ã«ã€Œ84.00ã€œ85.99ã€è¡¨ç¤º
          </div>
        </div>

        <div>
          <label>ä»Šã®ç‚¹æ•°ï¼ˆå…¥åŠ›ã™ã‚‹ã¨è©²å½“ãƒã‚¹ãŒå…‰ã‚‹ï¼‰</label>
          <input id="currentScore" type="number" step="0.01" placeholder="ä¾‹ï¼š85.23">
          <div class="hint">å…¥åŠ›ä¸­ã‚‚è‡ªå‹•ã§åæ˜ ã—ã¾ã™ã€‚ç¯„å›²ã«å…¥ã£ã¦ã„ã‚‹ãƒã‚¹ãŒã€Œâ¬…ã“ã‚Œï¼ã€ã«ãªã‚Šã¾ã™ã€‚</div>
        </div>
      </div>
    </div>

    <div class="conditions-box" id="preConditions">
      <strong>æ¡ä»¶ãƒªã‚¹ãƒˆ</strong>
      <ul id="conditionList"></ul>
      <div class="cond-note">â€»ã€Œâ˜‘ã‚’å¤–ã™ã¨ç„¡ã—ã€ã«ã§ãã‚‹ã®ã¯ã€ä»Šå›è¿½åŠ ã—ãŸæ¡ä»¶ã ã‘ã§ã™ã€‚</div>
    </div>

    <table id="bingo"></table>
  </div>

  <div class="modal" id="bingoModal">
    <div class="modal-content">ãƒ“ãƒ³ã‚´ï¼</div>
  </div>

  <script>
    const GYO = ["ã‚", "ã‹", "ã•", "ãŸ", "ãª", "ã¯", "ã¾", "ã‚„", "ã‚‰", "ã‚"];
    const DAN = ["ã‚", "ã„", "ã†", "ãˆ", "ãŠ"];

    const baseConditions = [
      { name: "ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ", cat: "cat-other" },
      { name: "ãƒãƒ©ãƒ¼ãƒ‰", cat: "cat-other" },
      { name: "ä¸€äººã ã‘çŸ¥ã‚‰ãªã„æ›²", cat: "cat-other" },
      { name: "2015â€“2017å¹´ãƒªãƒªãƒ¼ã‚¹", cat: "cat-release" },
      { name: "2018â€“2020å¹´ãƒªãƒªãƒ¼ã‚¹", cat: "cat-release" },
      { name: "2021â€“2023å¹´ãƒªãƒªãƒ¼ã‚¹", cat: "cat-release" },
      { name: "2024å¹´ä»¥é™ã®ãƒªãƒªãƒ¼ã‚¹", cat: "cat-release" },
      { name: "æ›²åæ¼¢å­—ã®ã¿", cat: "cat-title" },
      { name: "æ›²åè‹±èªã®ã¿", cat: "cat-title" },
      { name: "æ›²åã‚«ã‚¿ã‚«ãƒŠã®ã¿", cat: "cat-title" },
      { name: "æ—¥æœ¬èªã§8æ–‡å­—ä»¥ä¸Šã®æ›²", cat: "cat-lang" },
      { name: "æ—¥æœ¬èªã§2æ–‡å­—ä»¥ä¸‹ã®æ›²", cat: "cat-lang" },
      { name: "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåãŒã€‡è¡Œ or â–¡æ®µ", cat: "cat-artist" },
      { name: "æ›²åãŒã€‡è¡Œ or â–¡æ®µ", cat: "cat-title" },

      // è¿½åŠ æ¡ä»¶ï¼ˆâ˜‘ã§ç„¡ã—ã«ã§ãã‚‹ï¼‰
      { name: "â—¯äººãƒãƒ³ãƒ‰ï¼ˆã€‡ã¯3ï½5ï¼‰", cat: "cat-other", optional: true, optId: "opt_band" },
      { name: "å¤±æ‹ã‚½ãƒ³ã‚°", cat: "cat-other", optional: true, optId: "opt_breakup" },
      { name: "å¤ã®æ­Œ(éåŠæ•°ãŒå¤ã ã¨æ€ã£ãŸã‚‰OK)", cat: "cat-other", optional: true, optId: "opt_summer" },
      { name: "å†¬ã®æ­Œ(éåŠæ•°ãŒå†¬ã ã¨æ€ã£ãŸã‚‰OK)", cat: "cat-other", optional: true, optId: "opt_winter" },
      { name: "ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ã®æ›²", cat: "cat-other", optional: true, optId: "opt_disney" },
      { name: "ä¸»é¡Œæ­Œ", cat: "cat-other", optional: true, optId: "opt_theme" },
    ];

    function renderConditionList() {
      const ul = document.getElementById("conditionList");
      ul.innerHTML = "";

      baseConditions.forEach(c => {
        const li = document.createElement("li");

        if (c.optional) {
          const row = document.createElement("div");
          row.className = "cond-row";

          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.id = c.optId;
          cb.checked = true;

          const label = document.createElement("label");
          label.htmlFor = c.optId;
          label.textContent = c.name;

          row.appendChild(cb);
          row.appendChild(label);
          li.appendChild(row);
        } else {
          li.textContent = c.name;
        }
        ul.appendChild(li);
      });
    }
    renderConditionList();

    function rand(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    // â˜…ç¯„å›²ã®è¡¨ç¤ºã‚’ã€Œå…¥åŠ›ã§å¤‰ãˆã‚‰ã‚Œã‚‹ã€ã‚ˆã†ã«ã—ãŸé–¢æ•°
    function getRangeConfig() {
      const down = Number(document.getElementById("rangeDown").value);
      const up = Number(document.getElementById("rangeUp").value);
      return {
        down: isFinite(down) ? down : 1.00,
        up: isFinite(up) ? up : 0.99
      };
    }

    function formatRange(score) {
      const { down, up } = getRangeConfig();
      const low = score - down;
      const high = score + up;
      return `${low.toFixed(2)}ï½${high.toFixed(2)}`;
    }

    function generateBingo() {
      document.getElementById("preConditions").style.display = "none";
      const table = document.getElementById("bingo");
      table.innerHTML = "";

      const start = Number(startScore.value);
      const playerCount = Number(document.getElementById("playerCount").value);

      let conditions = [...baseConditions];

      // è¿½åŠ åˆ†ï¼šâ˜‘ã‚’å¤–ã—ãŸæ¡ä»¶ã¯é™¤å¤–
      conditions = conditions.filter(c => {
        if (!c.optional) return true;
        const cb = document.getElementById(c.optId);
        return cb ? cb.checked : true;
      });

      // å°‘äººæ•°æ™‚ã®æ¡ä»¶å‰Šé™¤
      if (playerCount <= 2) {
        conditions = conditions.filter(c => c.name !== "ä¸€äººã ã‘çŸ¥ã‚‰ãªã„æ›²");
      }

      /* ãƒãƒ©ãƒ¼ãƒ‰ / ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒåˆ¶å¾¡ */
      const tempoConditions = conditions.filter(
        c => c.name === "ãƒãƒ©ãƒ¼ãƒ‰" || c.name === "ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ"
      );
      const selectedTempo = rand(tempoConditions);
      conditions = conditions.filter(
        c => c.name !== "ãƒãƒ©ãƒ¼ãƒ‰" && c.name !== "ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ"
      );
      conditions.push(selectedTempo);

      /* å¹´ãƒªãƒªãƒ¼ã‚¹æ¡ä»¶ã¯æœ€å¤§2ã¤ã¾ã§ */
      const releaseConditions = conditions.filter(c => c.name.includes("ãƒªãƒªãƒ¼ã‚¹"));
      const otherConditions = conditions.filter(c => !c.name.includes("ãƒªãƒªãƒ¼ã‚¹"));
      const selectedReleases = releaseConditions.sort(() => Math.random() - 0.5).slice(0, 2);
      conditions = [...otherConditions, ...selectedReleases];

      /* 9ãƒã‚¹åˆ†ãã‚ãˆã‚‹ */
      while (conditions.length < 9) conditions.push(rand(conditions));
      conditions = conditions.sort(() => Math.random() - 0.5).slice(0, 9);

      let idx = 0;
      for (let r = 0; r < 3; r++) {
        const tr = table.insertRow();
        for (let c = 0; c < 3; c++) {
          const td = tr.insertCell();
          const cond = conditions[idx++];

          let name = cond.name;

          // æ—¢å­˜ï¼šè¡Œ/æ®µã®åŸ‹ã‚è¾¼ã¿
          if (name.includes("ã€‡è¡Œ")) {
            name = name.replace("ã€‡", rand(GYO)).replace("â–¡", rand(DAN));
          }

          // è¿½åŠ ï¼šâ—¯äººãƒãƒ³ãƒ‰ï¼ˆ3ï½5ï¼‰
          if (name.includes("â—¯äººãƒãƒ³ãƒ‰")) {
            const n = 3 + Math.floor(Math.random() * 3); // 3,4,5
            name = name.replace("â—¯", String(n));
          }

          const score = start + Math.floor(Math.random() * 11);

          // â˜…ã“ã®ãƒã‚¹ã®ç‚¹æ•°ã‚’ä¿æŒï¼ˆã‚ã¨ã§ã€Œå…¥åŠ›ç‚¹æ•°ã§å¼·èª¿ã€ã™ã‚‹ï¼‰
          td.dataset.score = String(score);

          td.className = cond.cat;
          td.innerHTML = `
            ${score}ç‚¹
            <span class="range">${formatRange(score)}</span>
            <div style="font-size:14px">${name}</div>
          `;

          td.onclick = () => {
            td.classList.toggle("marked");
            checkBingo();
          };
        }
      }

      // ç”Ÿæˆå¾Œã€å…¥åŠ›ç‚¹æ•°ãŒã‚ã‚Œã°å³å¼·èª¿
      highlightByCurrentScore();
    }

    // â˜…å…¥åŠ›ã—ãŸç‚¹æ•°ãŒã©ã®ç¯„å›²ã«å…¥ã‚‹ã‹ã€ãƒã‚¹ã‚’å¼·èª¿è¡¨ç¤º
    function highlightByCurrentScore() {
      const table = document.getElementById("bingo");
      if (!table || table.rows.length === 0) return;

      const val = Number(document.getElementById("currentScore").value);
      const hasVal = isFinite(val);

      // ã„ã£ãŸã‚“å…¨éƒ¨å¤–ã™
      for (const tr of table.rows) {
        for (const td of tr.cells) {
          td.classList.remove("in-range");
        }
      }
      if (!hasVal) return;

      const { down, up } = getRangeConfig();

      // ç¯„å›²ã«å…¥ã£ã¦ã‚‹ãƒã‚¹ã‚’ä»˜ã‘ã‚‹
      for (const tr of table.rows) {
        for (const td of tr.cells) {
          const s = Number(td.dataset.score);
          if (!isFinite(s)) continue;
          const low = s - down;
          const high = s + up;

          // ä¾‹ï¼š84.00ï½85.99 ãªã‚‰ low<=val<=high
          if (val >= low && val <= high) {
            td.classList.add("in-range");
          }
        }
      }
    }

    // â˜…ç¯„å›²å…¥åŠ›ã‚’å¤‰ãˆãŸã‚‰ã€è¡¨ç¤ºã‚‚å¼·èª¿ã‚‚æ›´æ–°
    function refreshRangesAndHighlight() {
      const table = document.getElementById("bingo");
      if (!table || table.rows.length === 0) return;

      for (const tr of table.rows) {
        for (const td of tr.cells) {
          const s = Number(td.dataset.score);
          if (!isFinite(s)) continue;
          const rangeEl = td.querySelector(".range");
          if (rangeEl) rangeEl.textContent = formatRange(s);
        }
      }
      highlightByCurrentScore();
    }

    // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆã§å³åæ˜ 
    document.getElementById("currentScore").addEventListener("input", highlightByCurrentScore);
    document.getElementById("rangeDown").addEventListener("input", refreshRangesAndHighlight);
    document.getElementById("rangeUp").addEventListener("input", refreshRangesAndHighlight);

    function checkBingo() {
      const t = document.getElementById("bingo");
      const lines = [
        [[0, 0], [0, 1], [0, 2]],
        [[1, 0], [1, 1], [1, 2]],
        [[2, 0], [2, 1], [2, 2]],
        [[0, 0], [1, 0], [2, 0]],
        [[0, 1], [1, 1], [2, 1]],
        [[0, 2], [1, 2], [2, 2]],
        [[0, 0], [1, 1], [2, 2]],
        [[0, 2], [1, 1], [2, 0]],
      ];

      if (lines.some(line =>
        line.every(([r, c]) => t.rows[r].cells[c].classList.contains("marked"))
      )) {
        // å…ƒã®ã€Œä½•ã‚‚ã—ãªã„ã€æŒ™å‹•ã¯ç¶­æŒï¼ˆå†…å®¹ã‚’å¤‰ãˆãªã„ï¼‰
      }
    }
  </script>
</body>

</html>
