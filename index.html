<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚«ãƒ©ã‚ªã‚±ãƒ“ãƒ³ã‚´</title>

  <style>
    body {
      font-family: "Segoe UI", system-ui, sans-serif;
      background: linear-gradient(135deg, #1e1e2f, #2b2b45);
      color: #fff;
      margin: 0;
      padding: 16px;
    }

    h1 {
      text-align: center;
      margin-bottom: 8px;
    }

    .container {
      max-width: 900px;
      margin: auto;
    }

    .controls,
    .description,
    .conditions-box,
    .range-controls {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .controls input,
    .range-controls input {
      width: 100%;
      padding: 8px;
      margin-bottom: 8px;
      border-radius: 8px;
      border: none;
    }

    button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      background: linear-gradient(135deg, #ff7a18, #ffb347);
      color: #000;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 12px;
    }

    td {
      height: 150px;
      border-radius: 18px;
      text-align: center;
      font-weight: bold;
      font-size: 26px;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
      position: relative;
    }

    td.marked {
      background: #00e676 !important;
      color: #000;
    }

    .range {
      display: block;
      font-size: 12px;
      font-weight: normal;
      margin-top: 4px;
      opacity: 0.95;
    }

    /* å…¥åŠ›ã—ãŸç‚¹æ•°ãŒã“ã®ãƒã‚¹ã®ç¯„å›²ã«å…¥ã£ãŸã‚‰å¼·èª¿ */
    td.in-range {
      outline: 5px solid #fff;
      transform: translateY(-2px);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.55);
    }

    td.in-range::after {
      content: "â¬… ã“ã‚Œï¼";
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.85);
      color: #000;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 700;
    }

    /* ã‚«ãƒ†ã‚´ãƒªè‰² */
    .cat-release {
      background: #ff8a80;
    }

    .cat-title {
      background: #82b1ff;
    }

    .cat-lang {
      background: #b9f6ca;
    }

    .cat-artist {
      background: #ffd180;
    }

    .cat-other {
      background: #e1bee7;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: #fff;
      color: #000;
      padding: 24px 32px;
      border-radius: 16px;
      font-size: 32px;
      font-weight: bold;
    }

    /* æ¡ä»¶ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ç”¨ */
    .conditions-box ul {
      margin: 8px 0 0;
      padding-left: 0;
    }

    .conditions-box li {
      margin: 6px 0;
      list-style: none;
    }

    .cond-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .cond-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #ffb347;
      cursor: pointer;
    }

    .cond-note {
      opacity: 0.85;
      font-size: 12px;
      margin-top: 8px;
    }

    .badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.12);
      font-size: 12px;
      margin-top: 4px;
    }

    .hint {
      opacity: 0.85;
      font-size: 12px;
      margin-top: 4px;
      line-height: 1.4;
    }

    .sec-title {
      margin-top: 10px;
      font-weight: 800;
      opacity: 0.95;
    }

    .small {
      font-size: 12px;
      opacity: 0.85;
      margin-top: 4px;
    }
  </style>
</head>

<body>
  <h1>ğŸ¤ ã‚«ãƒ©ã‚ªã‚±ãƒ“ãƒ³ã‚´</h1>

  <div class="description">
    <p>
      é–‹å§‹ç‚¹æ•°ã¨ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã€äººæ•°ã‚’å…¥åŠ›ã—ã¦ãƒ“ãƒ³ã‚´ç”Ÿæˆã€‚<br>
      æ¡ä»¶ã¨ç‚¹æ•°ãŒä¸€è‡´ã—ãŸã‚‰ãƒã‚¹ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚
    </p>

    <br>

    <p style="font-size: 20px; font-weight: bold;">
      ã‚«ãƒ©ã‚ªã‚±ãƒ“ãƒ³ã‚´ã®ãƒ«ãƒ¼ãƒ«
    </p>

    <p>
      1. ä»»æ„ã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚’3ã¤ã¨é–‹å§‹ç‚¹æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
      2. ã€Œãƒ“ãƒ³ã‚´ã‚’ç”Ÿæˆã€ã‚’æŠ¼ã™ã¨ã€é–‹å§‹ç‚¹æ•°ã‹ã‚‰+10ç‚¹ã¾ã§ã®ç¯„å›²ã§ãƒã‚¹ãŒãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚Œã¾ã™ã€‚<br>
      3. è‡ªåˆ†ãŒæ­Œã£ãŸæ›²ã‚„ä»–ã®äººãŒæ­Œã£ãŸæ›²ã§ã€ãƒã‚¹ã®æ¡ä»¶ã«å½“ã¦ã¯ã¾ã£ãŸå ´åˆã¯ã€è©²å½“ãƒã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒãƒ¼ã‚¯ã—ã¦ãã ã•ã„ã€‚<br>
      4. ä»–ã®äººãŒã™ã§ã«æ­Œã£ãŸæ›²ã¯ã€åŒã˜æ›²ã‚’ã‚‚ã†ä¸€åº¦æ­Œã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚<br>
      5. æ¡ä»¶ãƒªã‚¹ãƒˆã¯å³å´ã§ãƒ“ãƒ³ã‚´ç”Ÿæˆå‰ã«ç¢ºèªã§ãã¾ã™ã€‚
    </p>
  </div>


  <div class="container">
    <div class="controls">
      <input id="artist1" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ1">
      <input id="artist2" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ2">
      <input id="artist3" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ3">

      <label>é–‹å§‹ç‚¹æ•°ï¼ˆç‚¹ï¼‰</label>
      <input id="startScore" type="number" value="80">

      <label>éŠã¶äººæ•°ï¼ˆäººï¼‰</label>
      <input id="playerCount" type="number" min="1" value="2">

      <button onclick="generateBingo()">ãƒ“ãƒ³ã‚´ç”Ÿæˆ</button>
    </div>

    <div class="range-controls">
      <strong>ç‚¹æ•°ç¯„å›²ãƒ»å…¥åŠ›ç‚¹æ•°</strong>
      <div style="margin-top:8px;">
        <label>ç‚¹æ•°ç¯„å›²ï¼ˆä¸‹ã«ä½•ç‚¹ã€œä¸Šã«ä½•ç‚¹è¡¨ç¤ºã™ã‚‹ã‹ï¼‰</label>
        <input id="rangeDown" type="number" step="0.01" value="1.00" min="0">
        <input id="rangeUp" type="number" step="0.01" value="0.99" min="0">
        <div class="hint">
          ä¾‹ï¼š<span class="badge">ä¸‹ 1.00 / ä¸Š 0.99</span> â†’ ã€Œ85ç‚¹ã€ã®ä¸‹ã«ã€Œ84.00ã€œ85.99ã€è¡¨ç¤º
        </div>

        <label style="margin-top:8px; display:block;">ä»Šã®ç‚¹æ•°ï¼ˆå…¥åŠ›ã™ã‚‹ã¨è©²å½“ãƒã‚¹ãŒå…‰ã‚‹ï¼‰</label>
        <input id="currentScore" type="number" step="0.01" placeholder="ä¾‹ï¼š85.23">
        <div class="hint">å…¥åŠ›ä¸­ã‚‚è‡ªå‹•ã§åæ˜ ã—ã¾ã™ã€‚ç¯„å›²ã«å…¥ã£ã¦ã„ã‚‹ãƒã‚¹ãŒã€Œâ¬…ã“ã‚Œï¼ã€ã«ãªã‚Šã¾ã™ã€‚</div>
      </div>
    </div>

    <div class="conditions-box" id="preConditions">
      <strong>æ¡ä»¶ãƒªã‚¹ãƒˆ</strong>
      <div class="small">â€»ãƒ“ãƒ³ã‚´ã¯ã€Œã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ(1ã€œ3) Ã— {ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ/ãƒãƒ©ãƒ¼ãƒ‰/ã¿ã‚“ãªçŸ¥ã£ã¦ã„ã‚‹æ›²}ã€ã®3Ã—3ã§å›ºå®šã§ã™ã€‚</div>

      <div class="sec-title">ã“ã®ãƒ“ãƒ³ã‚´ã§ä½¿ã†æ¡ä»¶ï¼ˆ3Ã—3ï¼‰</div>
      <ul id="comboList"></ul>

      <div class="sec-title">è¿½åŠ ã®æ¡ä»¶ï¼ˆâ˜‘ã‚’å¤–ã™ã¨ã€Œç„¡ã—ã€ï¼‰</div>
      <ul id="conditionList"></ul>

      <div class="cond-note">â€»ã€Œãƒªãƒªãƒ¼ã‚¹å¹´åº¦ã€ã¯ä¸€è¦§ã¨ã—ã¦æ®‹ã—ã¦ã„ã¾ã™ï¼ˆãƒ“ãƒ³ã‚´3Ã—3ã«ã¯ç›´æ¥ã¯å…¥ã‚Šã¾ã›ã‚“ï¼‰ã€‚</div>
    </div>

    <table id="bingo"></table>
  </div>

  <div class="modal" id="bingoModal">
    <div class="modal-content">ãƒ“ãƒ³ã‚´ï¼</div>
  </div>

  <script>
    /* ===============================
       è¿½åŠ ï¼šã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ5å€‹ãƒ©ãƒ³ãƒ€ãƒ 
       =============================== */
    const ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
    let alphaLetters = [];

    function pickAlpha5() {
      const pool = [...ALPHABET].sort(() => Math.random() - 0.5);
      alphaLetters = pool.slice(0, 5).sort(); // è¦‹ã‚„ã™ã„ã‚ˆã†ã«ä¸¦ã¹æ›¿ãˆ
      return alphaLetters;
    }

    /* ===============================
       è¿½åŠ æ¡ä»¶ï¼ˆãƒã‚§ãƒƒã‚¯ã§ç„¡ã—ï¼‰
       =============================== */
    const extraConditions = [
      // ãƒªãƒªãƒ¼ã‚¹å¹´ã®æ¡ä»¶ã¯ã€Œã²ã¨ã¾ã¨ã‚ã€ã«å¤‰æ›´
      { name: "ãƒªãƒªãƒ¼ã‚¹å¹´åº¦", cat: "cat-release" },

      // ã¾ã¨ã‚ï¼šå¤/å†¬ã‚’1ã¤ã«
      { name: "å¤(å†¬)ã®æ­Œ(éåŠæ•°ãŒå¤(å†¬)ã ã¨æ€ã£ãŸã‚‰OK)", cat: "cat-other", optional: true, optId: "opt_season" },

      // æ—¢å­˜è¿½åŠ æ¡ä»¶
      { name: "â—¯äººãƒãƒ³ãƒ‰ï¼ˆã€‡ã¯3ï½5ï¼‰", cat: "cat-other", optional: true, optId: "opt_band" },
      { name: "å¤±æ‹ã‚½ãƒ³ã‚°", cat: "cat-other", optional: true, optId: "opt_breakup" },
      { name: "ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ã®æ›²", cat: "cat-other", optional: true, optId: "opt_disney" },
      { name: "ä¸»é¡Œæ­Œ", cat: "cat-other", optional: true, optId: "opt_theme" },

      // æ–°æ¡ä»¶ï¼šã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ5å€‹ã§å§‹ã¾ã‚‹ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆï¼ˆãƒã‚§ãƒƒã‚¯ã§ç„¡ã—ï¼‰
      { name: "ã€‡ã€ã€‡ã€ã€‡ã€ã€‡ã€ã€‡ã§å§‹ã¾ã‚‹ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ", cat: "cat-artist", optional: true, optId: "opt_alpha" },
    ];

    /* ===============================
       3Ã—3å›ºå®šï¼šåˆ—æ¡ä»¶
       =============================== */
    const FIXED_TYPES = ["ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ", "ãƒãƒ©ãƒ¼ãƒ‰", "ã¿ã‚“ãªçŸ¥ã£ã¦ã„ã‚‹æ›²"];

    function getArtists() {
      const a1 = (document.getElementById("artist1").value || "").trim();
      const a2 = (document.getElementById("artist2").value || "").trim();
      const a3 = (document.getElementById("artist3").value || "").trim();

      // æœªå…¥åŠ›ã§ã‚‚ 3Ã—3ã‚’å´©ã•ãªã„ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      return [
        a1 || "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ1(æœªå…¥åŠ›)",
        a2 || "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ2(æœªå…¥åŠ›)",
        a3 || "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ3(æœªå…¥åŠ›)"
      ];
    }

    function getRangeConfig() {
      const down = Number(document.getElementById("rangeDown").value);
      const up = Number(document.getElementById("rangeUp").value);
      return {
        down: isFinite(down) ? down : 1.00,
        up: isFinite(up) ? up : 0.99
      };
    }

    function formatRange(score) {
      const { down, up } = getRangeConfig();
      const low = score - down;
      const high = score + up;
      return `${low.toFixed(2)}ï½${high.toFixed(2)}`;
    }

    function renderConditionList() {
      // 3Ã—3 combo è¡¨ç¤º
      const comboUl = document.getElementById("comboList");
      comboUl.innerHTML = "";
      const artists = getArtists();
      artists.forEach(a => {
        FIXED_TYPES.forEach(t => {
          const li = document.createElement("li");
          li.textContent = `ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆï¼š${a} Ã— ${t}`;
          comboUl.appendChild(li);
        });
      });

      // è¿½åŠ æ¡ä»¶ï¼ˆãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰
      const ul = document.getElementById("conditionList");
      ul.innerHTML = "";

      extraConditions.forEach(c => {
        const li = document.createElement("li");

        if (c.optional) {
          const row = document.createElement("div");
          row.className = "cond-row";

          const cb = document.createElement("input");
          cb.type = "checkbox";
          cb.id = c.optId;
          cb.checked = true;

          const label = document.createElement("label");
          label.htmlFor = c.optId;

          // ã‚¢ãƒ«ãƒ•ã‚¡æ¡ä»¶ã¯ç¾åœ¨ã®ã‚¢ãƒ«ãƒ•ã‚¡ã‚’åŸ‹ã‚ã¦è¦‹ã›ã‚‹
          if (c.optId === "opt_alpha") {
            const letters = (alphaLetters.length ? alphaLetters : pickAlpha5()).join("ã€");
            label.textContent = c.name.replace("ã€‡ã€ã€‡ã€ã€‡ã€ã€‡ã€ã€‡", letters);
          } else {
            label.textContent = c.name;
          }

          row.appendChild(cb);
          row.appendChild(label);
          li.appendChild(row);
        } else {
          li.textContent = c.name;
        }

        ul.appendChild(li);
      });
    }

    /* åˆæœŸè¡¨ç¤º */
    pickAlpha5();
    renderConditionList();

    // ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå…¥åŠ›ãŒå¤‰ã‚ã£ãŸã‚‰ã€æ¡ä»¶ãƒªã‚¹ãƒˆã® 3Ã—3 è¡¨ç¤ºã‚‚æ›´æ–°
    ["artist1", "artist2", "artist3"].forEach(id => {
      document.getElementById(id).addEventListener("input", renderConditionList);
    });

    function rand(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function generateBingo() {
      document.getElementById("preConditions").style.display = "none";
      const table = document.getElementById("bingo");
      table.innerHTML = "";

      const start = Number(startScore.value);

      // ãƒ“ãƒ³ã‚´ç”Ÿæˆã®ãŸã³ã«ã€ã‚¢ãƒ«ãƒ•ã‚¡æ¡ä»¶ã®5æ–‡å­—ã‚’ã€Œãƒ©ãƒ³ãƒ€ãƒ ã«æ›´æ–°ã€
      pickAlpha5();

      // 3Ã—3 å›ºå®šç”Ÿæˆï¼ˆè¡Œï¼šartist1..3 / åˆ—ï¼šã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒãƒ»ãƒãƒ©ãƒ¼ãƒ‰ãƒ»ã¿ã‚“ãªçŸ¥ã£ã¦ã„ã‚‹æ›²ï¼‰
      const artists = getArtists();

      for (let r = 0; r < 3; r++) {
        const tr = table.insertRow();
        for (let c = 0; c < 3; c++) {
          const td = tr.insertCell();

          const artistName = artists[r];
          const typeName = FIXED_TYPES[c];

          const score = start + Math.floor(Math.random() * 11);
          td.dataset.score = String(score);

          // è¦‹ãŸç›®ã‚«ãƒ†ã‚´ãƒªï¼šã‚¿ã‚¤ãƒ—ã«ã‚ˆã£ã¦è‰²ã‚’å°‘ã—åˆ†ã‘ã‚‹ï¼ˆå¤§æ ã¯ç¶­æŒï¼‰
          td.className = (typeName === "ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ" || typeName === "ãƒãƒ©ãƒ¼ãƒ‰") ? "cat-other" : "cat-title";

          td.innerHTML = `
            ${score}ç‚¹
            <span class="range">${formatRange(score)}</span>
            <div style="font-size:14px; margin-top:6px;">
              <div>ğŸ¤ ${artistName}</div>
              <div>âœ… ${typeName}</div>
            </div>
          `;

          td.onclick = () => {
            td.classList.toggle("marked");
            checkBingo();
          };
        }
      }

      highlightByCurrentScore();
    }

    /* å…¥åŠ›ã—ãŸç‚¹æ•°ãŒã©ã®ç¯„å›²ã«å…¥ã‚‹ã‹ã€ãƒã‚¹ã‚’å¼·èª¿è¡¨ç¤º */
    function highlightByCurrentScore() {
      const table = document.getElementById("bingo");
      if (!table || table.rows.length === 0) return;

      const val = Number(document.getElementById("currentScore").value);
      const hasVal = isFinite(val);

      for (const tr of table.rows) {
        for (const td of tr.cells) td.classList.remove("in-range");
      }
      if (!hasVal) return;

      const { down, up } = getRangeConfig();

      for (const tr of table.rows) {
        for (const td of tr.cells) {
          const s = Number(td.dataset.score);
          if (!isFinite(s)) continue;
          const low = s - down;
          const high = s + up;
          if (val >= low && val <= high) td.classList.add("in-range");
        }
      }
    }

    /* ç¯„å›²å…¥åŠ›ã‚’å¤‰ãˆãŸã‚‰ã€è¡¨ç¤ºã‚‚å¼·èª¿ã‚‚æ›´æ–° */
    function refreshRangesAndHighlight() {
      const table = document.getElementById("bingo");
      if (!table || table.rows.length === 0) return;

      for (const tr of table.rows) {
        for (const td of tr.cells) {
          const s = Number(td.dataset.score);
          if (!isFinite(s)) continue;
          const rangeEl = td.querySelector(".range");
          if (rangeEl) rangeEl.textContent = formatRange(s);
        }
      }
      highlightByCurrentScore();
    }

    document.getElementById("currentScore").addEventListener("input", highlightByCurrentScore);
    document.getElementById("rangeDown").addEventListener("input", refreshRangesAndHighlight);
    document.getElementById("rangeUp").addEventListener("input", refreshRangesAndHighlight);

    function checkBingo() {
      const t = document.getElementById("bingo");
      const lines = [
        [[0, 0], [0, 1], [0, 2]],
        [[1, 0], [1, 1], [1, 2]],
        [[2, 0], [2, 1], [2, 2]],
        [[0, 0], [1, 0], [2, 0]],
        [[0, 1], [1, 1], [2, 1]],
        [[0, 2], [1, 2], [2, 2]],
        [[0, 0], [1, 1], [2, 2]],
        [[0, 2], [1, 1], [2, 0]],
      ];

      if (lines.some(line =>
        line.every(([r, c]) => t.rows[r].cells[c].classList.contains("marked"))
      )) {
        // å…ƒã®æŒ™å‹•ç¶­æŒï¼ˆä½•ã‚‚ã—ãªã„ï¼‰
      }
    }
  </script>
</body>

</html>
