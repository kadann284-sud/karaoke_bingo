<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚«ãƒ©ã‚ªã‚±ãƒ“ãƒ³ã‚´</title>

  <style>
    body {
      font-family: "Segoe UI", system-ui, sans-serif;
      background: linear-gradient(135deg, #1e1e2f, #2b2b45);
      color: #fff;
      margin: 0;
      padding: 16px;
    }

    h1 {
      text-align: center;
      margin-bottom: 8px;
    }

    .container {
      max-width: 900px;
      margin: auto;
    }

    .controls,
    .description,
    .conditions-box,
    .range-controls {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .controls input,
    .range-controls input {
      width: 100%;
      padding: 8px;
      margin-bottom: 8px;
      border-radius: 8px;
      border: none;
    }

    button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      background: linear-gradient(135deg, #ff7a18, #ffb347);
      color: #000;
      cursor: pointer;
    }

    table {
      width: 100%;
      table-layout: fixed;
      border-collapse: separate;
      border-spacing: 12px;
    }

    td {
      height: 150px;
      border-radius: 18px;
      text-align: center;
      font-weight: bold;
      font-size: 26px;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
      position: relative;

      overflow: hidden;
      vertical-align: middle;
      padding: 10px;
    }

    .cond-text {
      font-size: 14px;
      line-height: 1.2;
      margin-top: 4px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      word-break: break-word;
    }

    .info-btn {
      position: absolute;
      left: 10px;
      top: 10px;
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 800;
      background: rgba(255, 255, 255, 0.85);
      color: #000;
      cursor: pointer;
      width: auto;
    }

    td.marked {
      background: #00e676 !important;
      color: #000;
    }

    .range {
      display: block;
      font-size: 12px;
      font-weight: normal;
      margin-top: 4px;
      opacity: 0.95;
    }

    td.in-range {
      outline: 5px solid #fff;
      transform: translateY(-2px);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.55);
    }

    td.in-range::after {
      content: "â¬… ã“ã‚Œï¼";
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.85);
      color: #000;
      padding: 4px 8px;
      border-radius: 999px;
      font-weight: 700;
    }

    .cat-release { background: #ff8a80; }
    .cat-title { background: #82b1ff; }
    .cat-lang { background: #b9f6ca; }
    .cat-artist { background: #ffd180; }
    .cat-other { background: #e1bee7; }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 9999;
    }

    .modal-content {
      width: min(560px, 100%);
      background: #fff;
      color: #000;
      padding: 18px 18px;
      border-radius: 16px;
      font-weight: 700;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
    }

    .modal-title {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .modal-line {
      font-size: 14px;
      font-weight: 600;
      margin: 6px 0;
      opacity: 0.9;
    }

    .modal-cond {
      margin-top: 10px;
      font-size: 16px;
      font-weight: 800;
      line-height: 1.35;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .modal-close {
      margin-top: 14px;
      width: 100%;
      background: #111;
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 10px;
      font-size: 14px;
      font-weight: 800;
      cursor: pointer;
    }

    .conditions-box ul {
      margin: 8px 0 0;
      padding-left: 0;
    }

    .conditions-box li {
      margin: 6px 0;
      list-style: none;
    }

    .cond-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .cond-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #ffb347;
      cursor: pointer;
    }

    .cond-note {
      opacity: 0.85;
      font-size: 12px;
      margin-top: 8px;
    }

    .badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.12);
      font-size: 12px;
      margin-top: 4px;
    }

    .hint {
      opacity: 0.85;
      font-size: 12px;
      margin-top: 4px;
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <h1>ğŸ¤ ã‚«ãƒ©ã‚ªã‚±ãƒ“ãƒ³ã‚´</h1>

  <div class="description">
    <p>
      é–‹å§‹ç‚¹æ•°ã¨ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã€äººæ•°ã‚’å…¥åŠ›ã—ã¦ãƒ“ãƒ³ã‚´ç”Ÿæˆã€‚<br>
      æ¡ä»¶ã¨ç‚¹æ•°ãŒä¸€è‡´ã—ãŸã‚‰ãƒã‚¹ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚
    </p>

    <br>

    <p style="font-size: 20px; font-weight: bold;">
      ã‚«ãƒ©ã‚ªã‚±ãƒ“ãƒ³ã‚´ã®ãƒ«ãƒ¼ãƒ«
    </p>

    <p>
      1. ä»»æ„ã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚’3ã¤ã¨é–‹å§‹ç‚¹æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
      2. ã€Œãƒ“ãƒ³ã‚´ã‚’ç”Ÿæˆã€ã‚’æŠ¼ã™ã¨ã€é–‹å§‹ç‚¹æ•°ã‹ã‚‰+10ç‚¹ã¾ã§ã®ç¯„å›²ã§ãƒã‚¹ãŒãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚Œã¾ã™ã€‚<br>
      3. è‡ªåˆ†ãŒæ­Œã£ãŸæ›²ã‚„ä»–ã®äººãŒæ­Œã£ãŸæ›²ã§ã€ãƒã‚¹ã®æ¡ä»¶ã«å½“ã¦ã¯ã¾ã£ãŸå ´åˆã¯ã€è©²å½“ãƒã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒãƒ¼ã‚¯ã—ã¦ãã ã•ã„ã€‚<br>
      4. ä»–ã®äººãŒã™ã§ã«æ­Œã£ãŸæ›²ã¯ã€åŒã˜æ›²ã‚’ã‚‚ã†ä¸€åº¦æ­Œã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚<br>
      5. æ¡ä»¶ãƒªã‚¹ãƒˆã¯å³å´ã§ãƒ“ãƒ³ã‚´ç”Ÿæˆå‰ã«ç¢ºèªã§ãã¾ã™ã€‚
    </p>
  </div>

  <div class="container">
    <div class="controls">
      <input id="artist1" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ1">
      <input id="artist2" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ2">
      <input id="artist3" placeholder="ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ3">

      <label>é–‹å§‹ç‚¹æ•°ï¼ˆç‚¹ï¼‰</label>
      <input id="startScore" type="number" value="80">

      <label>éŠã¶äººæ•°ï¼ˆäººï¼‰</label>
      <input id="playerCount" type="number" min="1" value="2">

      <button onclick="generateBingo()">ãƒ“ãƒ³ã‚´ç”Ÿæˆ</button>
    </div>

    <div class="range-controls">
      <strong>ç‚¹æ•°ç¯„å›²ãƒ»å…¥åŠ›ç‚¹æ•°</strong>
      <div style="margin-top:8px;">
        <label>ç‚¹æ•°ç¯„å›²ï¼ˆä¸‹ã«ä½•ç‚¹ã€œä¸Šã«ä½•ç‚¹è¡¨ç¤ºã™ã‚‹ã‹ï¼‰</label>
        <input id="rangeDown" type="number" step="0.01" value="1.00" min="0">
        <input id="rangeUp" type="number" step="0.01" value="0.99" min="0">
        <div class="hint">
          ä¾‹ï¼š<span class="badge">ä¸‹ 1.00 / ä¸Š 0.99</span> â†’ ã€Œ85ç‚¹ã€ã®ä¸‹ã«ã€Œ84.00ã€œ85.99ã€è¡¨ç¤º
        </div>

        <label style="margin-top:8px; display:block;">ä»Šã®ç‚¹æ•°ï¼ˆå…¥åŠ›ã™ã‚‹ã¨è©²å½“ãƒã‚¹ãŒå…‰ã‚‹ï¼‰</label>
        <input id="currentScore" type="number" step="0.01" placeholder="ä¾‹ï¼š85.23">
        <div class="hint">å…¥åŠ›ä¸­ã‚‚è‡ªå‹•ã§åæ˜ ã—ã¾ã™ã€‚ç¯„å›²ã«å…¥ã£ã¦ã„ã‚‹ãƒã‚¹ãŒã€Œâ¬…ã“ã‚Œï¼ã€ã«ãªã‚Šã¾ã™ã€‚</div>
      </div>
    </div>

    <div class="conditions-box" id="preConditions">
      <strong>æ¡ä»¶ãƒªã‚¹ãƒˆ</strong>
      <ul id="conditionList"></ul>
      <div class="cond-note">â€»ã€Œâ˜‘ã‚’å¤–ã™ã¨ç„¡ã—ã€ã«ã§ãã‚‹ã®ã¯ã€è¿½åŠ æ¡ä»¶ã ã‘ã§ã™ã€‚</div>
    </div>

    <table id="bingo"></table>
  </div>

  <!-- å…¨æ–‡è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal" id="detailModal">
    <div class="modal-content">
      <div class="modal-title" id="detailTitle">è©³ç´°</div>
      <div class="modal-line" id="detailScoreLine"></div>
      <div class="modal-line" id="detailRangeLine"></div>
      <div class="modal-cond" id="detailCond"></div>
      <button class="modal-close" id="detailClose">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <script>
    /* ===============================
       ä»Šå›ã®å¤‰æ›´
       - å‰Šé™¤: ã€Œæ—¥æœ¬èªã§2æ–‡å­—ä»¥ä¸‹ã®æ›²ã€
       - è¿½åŠ ï¼ˆâ˜‘ãªã—å›ºå®šï¼‰: ã€Œã€‡æ–‡å­—ã®æ›²(è‹±èªã‚‚å¯)ã€(ã€‡=2ã€œ7)
       =============================== */

    /* ã‚¢ãƒ«ãƒ•ã‚¡æ¡ä»¶ï¼ˆB/Så‡ºã‚„ã™ãï¼‰ */
    const ALPHABET_WEIGHTED = (() => {
      const base = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
      return base.concat(["B", "B", "B", "B", "S", "S", "S", "S"]);
    })();

    let alphaLetters = [];
    function pickAlpha5() {
      const chosen = new Set();
      let guard = 0;
      while (chosen.size < 5 && guard < 2000) {
        const ch = ALPHABET_WEIGHTED[Math.floor(Math.random() * ALPHABET_WEIGHTED.length)];
        chosen.add(ch);
        guard++;
      }
      alphaLetters = [...chosen].sort();
      return alphaLetters;
    }

    /* ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆÃ—ã‚¿ã‚¤ãƒ—ï¼ˆãƒ©ãƒ³ãƒ€ãƒ 1å€‹ï¼‰ */
    const TYPE_POOL = ["ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ", "ãƒãƒ©ãƒ¼ãƒ‰"];

    function getArtists3ForCombo() {
      const a1 = (document.getElementById("artist1").value || "").trim() || "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ1(æœªå…¥åŠ›)";
      const a2 = (document.getElementById("artist2").value || "").trim() || "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ2(æœªå…¥åŠ›)";
      const a3 = (document.getElementById("artist3").value || "").trim() || "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ3(æœªå…¥åŠ›)";
      return [a1, a2, a3];
    }

    function pickArtistTypeComboCondition() {
      const artists3 = getArtists3ForCombo();
      const artist = artists3[Math.floor(Math.random() * artists3.length)];
      const type = TYPE_POOL[Math.floor(Math.random() * TYPE_POOL.length)];
      return { name: `${artist} ã® ${type}`, cat: "cat-other", isCombo: true };
    }

    /* ãƒªãƒªãƒ¼ã‚¹æ¡ä»¶ */
    const releaseConditions = [
      { name: "2015â€“2017å¹´ãƒªãƒªãƒ¼ã‚¹", cat: "cat-release", group: "release" },
      { name: "2018â€“2020å¹´ãƒªãƒªãƒ¼ã‚¹", cat: "cat-release", group: "release" },
      { name: "2021â€“2023å¹´ãƒªãƒªãƒ¼ã‚¹", cat: "cat-release", group: "release" },
      { name: "2024å¹´ä»¥é™ã®ãƒªãƒªãƒ¼ã‚¹", cat: "cat-release", group: "release" },
    ];

    /* åŸºæœ¬æ¡ä»¶ï¼ˆæ—¥æœ¬èª2æ–‡å­—ä»¥ä¸‹ã¯å‰Šé™¤æ¸ˆã¿ï¼‰
       â˜…è¿½åŠ ï¼ˆå›ºå®šï¼‰: ã€‡æ–‡å­—ã®æ›²(è‹±èªã‚‚å¯)
    */
    const baseConditions = [
      { name: "ä¸€äººã ã‘çŸ¥ã‚‰ãªã„æ›²", cat: "cat-other" },
      ...releaseConditions,

      { name: "æ›²åæ¼¢å­—ã®ã¿", cat: "cat-title" },
      { name: "æ›²åè‹±èªã®ã¿", cat: "cat-title" },
      { name: "æ›²åã‚«ã‚¿ã‚«ãƒŠã®ã¿", cat: "cat-title" },

      { name: "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåãŒã‚«ã‚¿ã‚«ãƒŠã®ã¿", cat: "cat-artist" },
      { name: "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåãŒæ¼¢å­—ã®ã¿", cat: "cat-artist" },

      { name: "æ—¥æœ¬èªã§8æ–‡å­—ä»¥ä¸Šã®æ›²", cat: "cat-lang" },

      // â˜…è¿½åŠ ï¼ˆâ˜‘ãªã—å›ºå®šï¼‰: æ•°å­—ã¯2ï½7ã§ãƒ©ãƒ³ãƒ€ãƒ 
      { name: "ã€‡æ–‡å­—ã®æ›²(è‹±èªã‚‚å¯)", cat: "cat-title", fixedLen: true },
    ];

    /* è¿½åŠ æ¡ä»¶ï¼ˆâ˜‘ã§ç„¡ã—ï¼‰ */
    const extraConditions = [
      { name: "å¤(å†¬)ã®æ­Œ(éåŠæ•°ãŒå¤(å†¬)ã ã¨æ€ã£ãŸã‚‰OK)", cat: "cat-other", optional: true, optId: "opt_season" },
      { name: "â—¯äººãƒãƒ³ãƒ‰ï¼ˆã€‡ã¯3ï½5ï¼‰", cat: "cat-other", optional: true, optId: "opt_band" },
      { name: "å¤±æ‹ã‚½ãƒ³ã‚°", cat: "cat-other", optional: true, optId: "opt_breakup" },
      { name: "ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ã®æ›²", cat: "cat-other", optional: true, optId: "opt_disney" },
      { name: "ä¸»é¡Œæ­Œ", cat: "cat-other", optional: true, optId: "opt_theme" },
    ];

    /* ã‚¢ãƒ«ãƒ•ã‚¡æ¡ä»¶ï¼ˆâ˜‘ãªã—å›ºå®šï¼‰ */
    const fixedAlphaCondition = {
      name: "ã€‡ã€ã€‡ã€ã€‡ã€ã€‡ã€ã€‡ã§å§‹ã¾ã‚‹ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ(ã€‡ã¯ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ)",
      cat: "cat-artist",
      fixed: true,
      optId: "opt_alpha_fixed"
    };

    function renderConditionList() {
      const ul = document.getElementById("conditionList");
      ul.innerHTML = "";

      const hasRelease = baseConditions.some(c => c.group === "release");
      baseConditions.forEach(c => {
        if (c.group === "release") return;
        const li = document.createElement("li");
        li.textContent = c.name;
        ul.appendChild(li);
      });

      if (hasRelease) {
        const li = document.createElement("li");
        li.textContent = "ãƒªãƒªãƒ¼ã‚¹å¹´åº¦";
        ul.appendChild(li);
      }

      // ã‚¢ãƒ«ãƒ•ã‚¡æ¡ä»¶ï¼šâ˜‘ãªã—ã§è¡¨ç¤º
      const liAlpha = document.createElement("li");
      liAlpha.style.marginTop = "10px";
      liAlpha.style.opacity = "0.95";
      liAlpha.textContent = fixedAlphaCondition.name;
      ul.appendChild(liAlpha);

      const liCombo = document.createElement("li");
      liCombo.style.marginTop = "10px";
      liCombo.style.opacity = "0.9";
      liCombo.textContent = "{ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ1,2,3}Ã—{ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ,ãƒãƒ©ãƒ¼ãƒ‰} ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ 1å€‹ï¼ˆä¾‹ï¼šã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ2ã®ãƒãƒ©ãƒ¼ãƒ‰ï¼‰";
      ul.appendChild(liCombo);

      const sep2 = document.createElement("li");
      sep2.style.opacity = "0.8";
      sep2.style.marginTop = "10px";
      sep2.textContent = "â€” è¿½åŠ æ¡ä»¶ï¼ˆâ˜‘ã§ç„¡ã—ï¼‰â€”";
      ul.appendChild(sep2);

      extraConditions.forEach(c => {
        const li = document.createElement("li");
        const row = document.createElement("div");
        row.className = "cond-row";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.id = c.optId;
        cb.checked = true;

        const label = document.createElement("label");
        label.htmlFor = c.optId;
        label.textContent = c.name;

        row.appendChild(cb);
        row.appendChild(label);
        li.appendChild(row);
        ul.appendChild(li);
      });
    }

    pickAlpha5();
    renderConditionList();

    function rand(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function randInt(min, max) { // inclusive
      return min + Math.floor(Math.random() * (max - min + 1));
    }

    function getRangeConfig() {
      const down = Number(document.getElementById("rangeDown").value);
      const up = Number(document.getElementById("rangeUp").value);
      return {
        down: isFinite(down) ? down : 1.00,
        up: isFinite(up) ? up : 0.99
      };
    }

    function formatRange(score) {
      const { down, up } = getRangeConfig();
      const low = score - down;
      const high = score + up;
      return `${low.toFixed(2)}ï½${high.toFixed(2)}`;
    }

    /* å…¨æ–‡è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« */
    const detailModal = document.getElementById("detailModal");
    const detailTitle = document.getElementById("detailTitle");
    const detailScoreLine = document.getElementById("detailScoreLine");
    const detailRangeLine = document.getElementById("detailRangeLine");
    const detailCond = document.getElementById("detailCond");
    const detailClose = document.getElementById("detailClose");

    function openDetail({ score, range, cond }) {
      detailTitle.textContent = "æ¡ä»¶ã®è©³ç´°";
      detailScoreLine.textContent = `ç‚¹æ•°ï¼š${score}ç‚¹`;
      detailRangeLine.textContent = `ç¯„å›²ï¼š${range}`;
      detailCond.textContent = cond;
      detailModal.style.display = "flex";
    }

    function closeDetail() {
      detailModal.style.display = "none";
    }

    detailClose.addEventListener("click", closeDetail);
    detailModal.addEventListener("click", (e) => {
      if (e.target === detailModal) closeDetail();
    });

    function generateBingo() {
      document.getElementById("preConditions").style.display = "none";
      const table = document.getElementById("bingo");
      table.innerHTML = "";

      const start = Number(startScore.value);
      const playerCount = Number(document.getElementById("playerCount").value);

      pickAlpha5();

      let conditions = [...baseConditions];

      // è¿½åŠ æ¡ä»¶ï¼šâ˜‘OFFã¯é™¤å¤–
      extraConditions.forEach(c => {
        const cb = document.getElementById(c.optId);
        if (cb && cb.checked) {
          conditions.push({ name: c.name, cat: c.cat, optId: c.optId });
        }
      });

      // ã‚¢ãƒ«ãƒ•ã‚¡æ¡ä»¶ï¼ˆå›ºå®šï¼‰
      conditions.push({ ...fixedAlphaCondition });

      // ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆÃ—{ã‚¢ãƒƒãƒ—ãƒ†ãƒ³ãƒ/ãƒãƒ©ãƒ¼ãƒ‰} ãƒ©ãƒ³ãƒ€ãƒ 1å€‹
      conditions.push(pickArtistTypeComboCondition());

      // å°‘äººæ•°æ™‚ã®æ¡ä»¶å‰Šé™¤
      if (playerCount <= 2) {
        conditions = conditions.filter(c => c.name !== "ä¸€äººã ã‘çŸ¥ã‚‰ãªã„æ›²");
      }

      // ãƒªãƒªãƒ¼ã‚¹æ¡ä»¶ã¯æœ€å¤§2ã¤ã¾ã§
      const rels = conditions.filter(c => (c.group === "release") || (c.name.includes("ãƒªãƒªãƒ¼ã‚¹")));
      const others = conditions.filter(c => !(c.group === "release") && !c.name.includes("ãƒªãƒªãƒ¼ã‚¹"));
      const selectedReleases = rels.sort(() => Math.random() - 0.5).slice(0, 2);
      conditions = [...others, ...selectedReleases];

      // 9ãƒã‚¹ãã‚ãˆã‚‹
      while (conditions.length < 9) conditions.push(rand(conditions));
      conditions = conditions.sort(() => Math.random() - 0.5).slice(0, 9);

      let idx = 0;
      for (let r = 0; r < 3; r++) {
        const tr = table.insertRow();
        for (let c = 0; c < 3; c++) {
          const td = tr.insertCell();
          const cond = conditions[idx++];

          let name = cond.name;

          // â—¯äººãƒãƒ³ãƒ‰ï¼ˆ3ï½5ï¼‰
          if (name.includes("â—¯äººãƒãƒ³ãƒ‰")) {
            const n = 3 + Math.floor(Math.random() * 3);
            name = name.replace("â—¯", String(n));
          }

          // ã€‡æ–‡å­—ã®æ›²ï¼ˆ2ï½7ï¼‰
          if (cond.fixedLen) {
            const n = randInt(2, 7);
            name = name.replace("ã€‡", String(n));
          }

          // ã‚¢ãƒ«ãƒ•ã‚¡æ¡ä»¶ï¼šãƒã‚¹ã§ã¯ã‚¢ãƒ«ãƒ•ã‚¡ã«ç½®æ›
          if (cond.optId === "opt_alpha_fixed") {
            const letters = alphaLetters.join("ã€");
            name = name.replace(/ã€‡ã€ã€‡ã€ã€‡ã€ã€‡ã€ã€‡/g, letters);
          }

          const score = start + Math.floor(Math.random() * 11);
          const range = formatRange(score);

          td.dataset.score = String(score);
          td.dataset.range = range;
          td.dataset.cond = name;

          td.className = cond.cat;
          td.innerHTML = `
            <button class="info-btn" type="button">â„¹ï¸ è©³ç´°</button>
            ${score}ç‚¹
            <span class="range">${range}</span>
            <div class="cond-text">${name}</div>
          `;

          td.onclick = () => {
            td.classList.toggle("marked");
            checkBingo();
          };

          const infoBtn = td.querySelector(".info-btn");
          infoBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            openDetail({
              score: td.dataset.score,
              range: td.dataset.range,
              cond: td.dataset.cond
            });
          });
        }
      }

      highlightByCurrentScore();
    }

    function highlightByCurrentScore() {
      const table = document.getElementById("bingo");
      if (!table || table.rows.length === 0) return;

      const val = Number(document.getElementById("currentScore").value);
      const hasVal = isFinite(val);

      for (const tr of table.rows) {
        for (const td of tr.cells) td.classList.remove("in-range");
      }
      if (!hasVal) return;

      const { down, up } = getRangeConfig();

      for (const tr of table.rows) {
        for (const td of tr.cells) {
          const s = Number(td.dataset.score);
          if (!isFinite(s)) continue;
          const low = s - down;
          const high = s + up;
          if (val >= low && val <= high) td.classList.add("in-range");
        }
      }
    }

    function refreshRangesAndHighlight() {
      const table = document.getElementById("bingo");
      if (!table || table.rows.length === 0) return;

      for (const tr of table.rows) {
        for (const td of tr.cells) {
          const s = Number(td.dataset.score);
          if (!isFinite(s)) continue;
          const rangeEl = td.querySelector(".range");
          if (rangeEl) {
            const range = formatRange(s);
            rangeEl.textContent = range;
            td.dataset.range = range;
          }
        }
      }
      highlightByCurrentScore();
    }

    document.getElementById("currentScore").addEventListener("input", highlightByCurrentScore);
    document.getElementById("rangeDown").addEventListener("input", refreshRangesAndHighlight);
    document.getElementById("rangeUp").addEventListener("input", refreshRangesAndHighlight);

    function checkBingo() {
      const t = document.getElementById("bingo");
      const lines = [
        [[0, 0], [0, 1], [0, 2]],
        [[1, 0], [1, 1], [1, 2]],
        [[2, 0], [2, 1], [2, 2]],
        [[0, 0], [1, 0], [2, 0]],
        [[0, 1], [1, 1], [2, 1]],
        [[0, 2], [1, 2], [2, 2]],
        [[0, 0], [1, 1], [2, 2]],
        [[0, 2], [1, 1], [2, 0]],
      ];

      if (lines.some(line =>
        line.every(([r, c]) => t.rows[r].cells[c].classList.contains("marked"))
      )) {
        // å…ƒã®æŒ™å‹•ç¶­æŒ
      }
    }
  </script>
</body>

</html>
